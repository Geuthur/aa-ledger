{% extends 'ledger/base.html' %}
{% load i18n %}
{% load humanize %}
{% load static %}

{% block vow_block %}

<div class="bg-primary rounded-top px-2 py-2 mb-4">
    <h3 class="text-white">{% translate "Ledger Character Overview" %}</h3>
</div>
<div class="card-body">
    <div class="row">
        <table class="table table-striped table-hover" id="members" style="width: 100%;">
            <br>
            <thead>
                <th class="col-portrait" style="width: 10%;"></th>
                <th class="col-user" style="width: 20%;">Character</th>
                <th class="col-group" style="width: 20%;">Corporation</th>
                <th class="col-actions" style="width: 10%;">Actions</th>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>
</div>

{% endblock %}

{% block extra_javascript %}
{% include 'bundles/datatables-js-bs5.html' %}
<script type="text/javascript">
document.addEventListener('DOMContentLoaded', function () {
    // Event Listener
    $('#modal-button-confirm-remove-request').on('click', function () {
        var deleteUrl = $(this).attr('data-delete-url');
        window.location.href = deleteUrl;
    });

    // Event-Listener
    $('#squads-request-remove').on('show.bs.modal', function (event) {
        var button = $(event.relatedTarget);
        var deleteUrl = button.data('delete-url');
        var memberName = button.data('delete-name');
        $('#modal-button-confirm-remove-request').attr('data-delete-url', deleteUrl);
        $('#name-to-delete').text(memberName);
    });

    // Initialize DataTable
    var Chars = $('#members').DataTable({
        ajax: {
            url: '/ledger/api/account/ledger/admin/',
            dataSrc: function (data) {
                // Transformieren der Daten in ein Array von Objekten
                var charactersArray = [];
                var charactersObj = data[0].character; // Zugriff auf das 'character'-Objekt
                for (var key in charactersObj) {
                    if (charactersObj.hasOwnProperty(key)) {
                        charactersArray.push(charactersObj[key]);
                    }
                }
                return charactersArray;
            },
        },
        processing: true,
        columns: [
            {data: 'character_id', title: ''},
            {data: 'character_name', title: 'Character'},
            {data: 'corporation_name', title: 'Corporation'},
            // Die Definition für die Actions-Spalte bleibt gleich
        ],
        columnDefs: [
            {
                targets: 0, // Zielt auf die erste Spalte
                render: function (data, type, row) {
                    // Erzeugt das Bild-Element für jeden Charakter
                    return '<img src="https://images.evetech.net/characters/' + row.character_id + '/portrait?size=32" class="rounded-circle" title="' + row.character_name + '" height="30">';
                },
            },
            {
                targets: 3,
                className: 'text-end',
                sortable: false,
                render: function (data, type, row) {
                    return '<a href="/ledger/character_ledger/'+ row.character_id +'/"><button class="btn btn-primary btn-sm" title="Edit"><i class="fa-solid fa-eye"></i></button></a>';
                },
            }
        ]
    });
});
</script>
{% endblock %}

{% block extra_css %}
{% endblock %}

{% block extra_script %}
{% endblock %}
